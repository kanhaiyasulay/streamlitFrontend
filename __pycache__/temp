import os
import asyncio
import certifi
import requests
from dotenv import load_dotenv
from langchain_mcp_adapters.client import MultiServerMCPClient
from langchain.chat_models import init_chat_model
from langchain.agents import create_agent

load_dotenv()

# Fix SSL issues in corporate environments
os.environ["SSL_CERT_FILE"] = certifi.where()


def get_azure_access_token():
    """
    Generates Azure AD token using Service Principal
    """

    tenant = os.getenv("AZURE_TENANT_ID")
    client_id = os.getenv("AZURE_CLIENT_ID")
    client_secret = os.getenv("AZURE_CLIENT_SECRET")

    if not tenant or not client_id or not client_secret:
        raise ValueError("Azure credentials missing in .env")

    url = f"https://login.microsoftonline.com/{tenant}/oauth2/v2.0/token"

    payload = {
        "client_id": client_id,
        "client_secret": client_secret,
        "scope": "https://analysis.windows.net/powerbi/api/.default",
        "grant_type": "client_credentials",
    }

    response = requests.post(url, data=payload)
    response.raise_for_status()

    token = response.json()["access_token"]
    print("‚úÖ Azure token generated successfully")
    return token


async def main():
    print("üîê Generating Azure access token...")
    token = get_azure_access_token()

    # Connect to Fabric MCP Endpoint
    servers = {
        "powerbi-remote": {
            "transport": "http",
            "url": "https://api.fabric.microsoft.com/v1/mcp/powerbi",
            "headers": {
                "Authorization": f"Bearer {token}"
            }
        }
    }

    print("üîå Connecting to MCP server...")
    client = MultiServerMCPClient(servers)

    tools = await client.get_tools()
    print(f"‚úÖ Connected. Discovered {len(tools)} MCP tools")

    # Initialize LLM
    model = init_chat_model(
        os.getenv("MODEL"),
        model_provider="openai",
        api_key=os.getenv("GITHUB_TOKEN"),
        base_url=os.getenv("ENDPOINT"),
    )

    system_prompt = """
    You are a FinOps analyst working with Power BI semantic models through MCP.
    Always use available MCP tools to inspect datasets instead of guessing.
    """

    agent_graph = create_agent(model, tools, system_prompt=system_prompt, debug=True)

    # üî¥ IMPORTANT ‚Äî provide actual IDs here
    workspace_id = os.getenv("POWERBI_WORKSPACE_ID")
    dataset_id = os.getenv("POWERBI_DATASET_ID")

    query = f"""
    Inspect this Power BI semantic model using MCP tools.

    Workspace ID: {workspace_id}
    Dataset ID: {dataset_id}

    Return:
    - List of all tables in the above dataset
    """

    inputs = {"messages": [{"role": "user", "content": query}]}

    print("üìä Fetching semantic model schema...")
    result = await agent_graph.ainvoke(inputs)

    print("\n================ RESULT ================\n")
    print(result)


if __name__ == "__main__":
    asyncio.run(main())


for the above code output is:

(mcp-help) PS C:\Users\KANSUL\mcp-help> python openAI_mcp.py
C:\Users\KANSUL\mcp-help\.venv\Lib\site-packages\langchain_core\_api\deprecation.py:25: UserWarning: Core Pydantic V1 functionality isn't compatible with Python 3.14 or greater.
  from pydantic.v1.fields import FieldInfo as FieldInfoV1
üîê Generating Azure access token...
‚úÖ Azure token generated successfully
üîå Connecting to MCP server...
‚úÖ Connected. Discovered 3 MCP tools
üìä Fetching semantic model schema...
[values] {'messages': [HumanMessage(content='\n    Inspect this Power BI semantic model using MCP tools.\n\n    Workspace ID: 816f9fea-3392-4ca9-8b02-4343d9e463b9\n    Dataset ID: bf47a12c-18e3-49b3-ad4d-8f90f282928c\n\n    Return:\n    - List of all tables in the above dataset\n    ', additional_kwargs={}, response_metadata={}, id='f5b18ac7-1252-4cad-8ecf-efdd01ccdb4c')]}
[updates] {'model': {'messages': [AIMessage(content='', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 41, 'prompt_tokens': 1229, 'total_tokens': 1270, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1152}}, 'model_provider': 'openai', 'model_name': 'gpt-4o-2024-11-20', 'system_fingerprint': 'fp_af7f7349a4', 'id': 'chatcmpl-DBfrIa7lSfNwEqm7y2z86Q8IcCpQn', 'finish_reason': 'tool_calls', 'logprobs': None}, id='lc_run--019c800d-5647-7471-a5c9-cdde68094d98-0', tool_calls=[{'name': 'GetSemanticModelSchema', 'args': {'artifactId': 'bf47a12c-18e3-49b3-ad4d-8f90f282928c'}, 'id': 'call_44iYkUSfMjzmgLfm2jfgCbT1', 'type': 'tool_call'}], invalid_tool_calls=[], usage_metadata={'input_tokens': 1229, 'output_tokens': 41, 'total_tokens': 1270, 'input_token_details': {'audio': 0, 'cache_read': 1152}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}}
[values] {'messages': [HumanMessage(content='\n    Inspect this Power BI semantic model using MCP tools.\n\n    Workspace ID: 816f9fea-3392-4ca9-8b02-4343d9e463b9\n    Dataset ID: bf47a12c-18e3-49b3-ad4d-8f90f282928c\n\n    Return:\n    - List of all tables in the above dataset\n    ', additional_kwargs={}, response_metadata={}, id='f5b18ac7-1252-4cad-8ecf-efdd01ccdb4c'), AIMessage(content='', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 41, 'prompt_tokens': 1229, 'total_tokens': 1270, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1152}}, 'model_provider': 'openai', 'model_name': 'gpt-4o-2024-11-20', 'system_fingerprint': 'fp_af7f7349a4', 'id': 'chatcmpl-DBfrIa7lSfNwEqm7y2z86Q8IcCpQn', 'finish_reason': 'tool_calls', 'logprobs': None}, id='lc_run--019c800d-5647-7471-a5c9-cdde68094d98-0', tool_calls=[{'name': 'GetSemanticModelSchema', 'args': {'artifactId': 'bf47a12c-18e3-49b3-ad4d-8f90f282928c'}, 'id': 'call_44iYkUSfMjzmgLfm2jfgCbT1', 'type': 'tool_call'}], invalid_tool_calls=[], usage_metadata={'input_tokens': 1229, 'output_tokens': 41, 'total_tokens': 1270, 'input_token_details': {'audio': 0, 'cache_read': 1152}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}
[updates] {'tools': {'messages': [ToolMessage(content=[], name='GetSemanticModelSchema', id='baf3773a-9dd2-4fbf-af99-8c16082b875a', tool_call_id='call_44iYkUSfMjzmgLfm2jfgCbT1', artifact={'structured_content': {'Tables': [{'Name': 'calendar', 'Columns': [{'Name': 'date', 'Type': 'DateTime', 'FormatString': 'D', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 5}, {'Name': 'year', 'Type': 'Text', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 1}, {'Name': 'quarter_no', 'Type': 'Text', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 2}, {'Name': 'quarter_yy_no', 'Type': 'Text'}, {'Name': 'month_no', 'Type': 'Double', 'FormatString': '0'}, {'Name': 'month', 'Type': 'Text'}, {'Name': 'month_yy_no', 'Type': 'Text', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 3}, {'Name': 'week_no', 'Type': 'Double'}, {'Name': 'week_yy_no', 'Type': 'Text', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 4}, {'Name': 'day_of_week', 'Type': 'Text'}, {'Name': 'month_start', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'month_end', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'quarter_start', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'quarter_end', 'Type': 'DateTime', 'FormatString': 'D'}]}, {'Name': 'cost', 'Columns': [{'Name': 'resId', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'date', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'nok', 'Type': 'Double'}, {'Name': 'raw_usd', 'Type': 'Double'}, {'Name': 'category', 'Type': 'Text'}, {'Name': 'sub_category', 'Type': 'Text'}, {'Name': 'name', 'Type': 'Text'}, {'Name': 'customer_id', 'Type': 'Text'}, {'Name': 'kubeit', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'usd', 'Type': 'Double'}, {'Name': 'customer_name', 'Type': 'Text'}]}, {'Name': 'customers', 'Columns': [{'Name': 'customer_id', 'Type': 'Text'}, {'Name': 'customer_name', 'Type': 'Text'}, {'Name': 'source', 'Type': 'Integer', 'FormatString': '0'}]}, {'Name': 'details', 'Columns': [{'Name': 'resource_id', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'detail', 'Type': 'Text'}, {'Name': 'value', 'Type': 'Text'}, {'Name': 'startDate', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'is_current', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'rn', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'endDate', 'Type': 'DateTime', 'FormatString': 'D'}]}, {'Name': 'regions', 'Columns': [{'Name': 'continent', 'Type': 'Text'}, {'Name': 'location', 'Type': 'Text'}, {'Name': 'geographyId', 'Type': 'Text'}, {'Name': 'latitude', 'Type': 'Text'}, {'Name': 'longitude', 'Type': 'Text'}, {'Name': 'typeId', 'Type': 'Text'}, {'Name': 'isOpen', 'Type': 'Text'}, {'Name': 'hasGroundStation', 'Type': 'Text'}, {'Name': 'yearOpen', 'Type': 'Text'}, {'Name': 'dataResidency', 'Type': 'Text'}, {'Name': 'availableTo', 'Type': 'Text'}, {'Name': 'announcementLink', 'Type': 'Text'}, {'Name': 'productsByRegionLink', 'Type': 'Text'}, {'Name': 'productsByRegionLinkNonRegional', 'Type': 'Text'}, {'Name': 'availabilityZonesId', 'Type': 'Text'}, {'Name': 'id', 'Type': 'Text'}, {'Name': 'displayName', 'Type': 'Text'}]}, {'Name': 'resources', 'Columns': [{'Name': 'resource_id', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'subscription_id', 'Type': 'Text'}, {'Name': 'subscription_name', 'Type': 'Text'}, {'Name': 'location', 'Type': 'Text'}, {'Name': 'resource_group', 'Type': 'Text'}, {'Name': 'type', 'Type': 'Text'}, {'Name': 'name', 'Type': 'Text'}, {'Name': 'customer_id', 'Type': 'Text'}, {'Name': 'current_state', 'Type': 'Text'}, {'Name': 'last_updated_time', 'Type': 'DateTime', 'FormatString': 'G'}, {'Name': 'customer_name', 'Type': 'Text'}]}, {'Name': 'subscriptions', 'Columns': [{'Name': 'subscription_id', 'Type': 'Text'}, {'Name': 'subscription_name', 'Type': 'Text'}, {'Name': 'management_group', 'Type': 'Text'}, {'Name': 'management_group_name', 'Type': 'Text'}]}, {'Name': 'tags', 'Columns': [{'Name': 'resource_id', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'product_centre', 'Type': 'Text'}, {'Name': 'solution_name', 'Type': 'Text'}, {'Name': 'environment', 'Type': 'Text'}, {'Name': 'project_number', 'Type': 'Text'}, {'Name': 'project_task', 'Type': 'Text'}, {'Name': 'owner', 'Type': 'Text'}, {'Name': 'verit-owneremail', 'Type': 'Text'}]}], 'ActiveRelationships': [{'PK': "'subscriptions'[subscription_id]", 'FK': "'resources'[subscription_id]", 'UnidirectionalFilter': "'subscriptions' filters 'resources'"}, {'PK': "'tags'[resource_id]", 'FK': "'resources'[resource_id]", 'BidirectionalFilter': "'tags' and 'resources' filter each other"}, {'PK': "'regions'[id]", 'FK': "'resources'[location]", 'UnidirectionalFilter': "'regions' filters 'resources'"}, {'PK': "'resources'[resource_id]", 'FK': "'tags'[resource_id]", 'BidirectionalFilter': "'resources' and 'tags' filter each other"}, {'PK': "'resources'[resource_id]", 'FK': "'cost'[resId]", 'UnidirectionalFilter': "'resources' filters 'cost'"}, {'PK': "'calendar'[date]", 'FK': "'cost'[date]", 'UnidirectionalFilter': "'calendar' filters 'cost'"}, {'PK': "'resources'[resource_id]", 'FK': "'details'[resource_id]", 'UnidirectionalFilter': "'resources' filters 'details'"}]}})]}}
[values] {'messages': [HumanMessage(content='\n    Inspect this Power BI semantic model using MCP tools.\n\n    Workspace ID: 816f9fea-3392-4ca9-8b02-4343d9e463b9\n    Dataset ID: bf47a12c-18e3-49b3-ad4d-8f90f282928c\n\n    Return:\n    - List of all tables in the above dataset\n    ', additional_kwargs={}, response_metadata={}, id='f5b18ac7-1252-4cad-8ecf-efdd01ccdb4c'), AIMessage(content='', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 41, 'prompt_tokens': 1229, 'total_tokens': 1270, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1152}}, 'model_provider': 'openai', 'model_name': 'gpt-4o-2024-11-20', 'system_fingerprint': 'fp_af7f7349a4', 'id': 'chatcmpl-DBfrIa7lSfNwEqm7y2z86Q8IcCpQn', 'finish_reason': 'tool_calls', 'logprobs': None}, id='lc_run--019c800d-5647-7471-a5c9-cdde68094d98-0', tool_calls=[{'name': 'GetSemanticModelSchema', 'args': {'artifactId': 'bf47a12c-18e3-49b3-ad4d-8f90f282928c'}, 'id': 'call_44iYkUSfMjzmgLfm2jfgCbT1', 'type': 'tool_call'}], invalid_tool_calls=[], usage_metadata={'input_tokens': 1229, 'output_tokens': 41, 'total_tokens': 1270, 'input_token_details': {'audio': 0, 'cache_read': 1152}, 'output_token_details': {'audio': 0, 'reasoning': 0}}), ToolMessage(content=[], name='GetSemanticModelSchema', id='baf3773a-9dd2-4fbf-af99-8c16082b875a', tool_call_id='call_44iYkUSfMjzmgLfm2jfgCbT1', artifact={'structured_content': {'Tables': [{'Name': 'calendar', 'Columns': [{'Name': 'date', 'Type': 'DateTime', 'FormatString': 'D', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 5}, {'Name': 'year', 'Type': 'Text', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 1}, {'Name': 'quarter_no', 'Type': 'Text', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 2}, {'Name': 'quarter_yy_no', 'Type': 'Text'}, {'Name': 'month_no', 'Type': 'Double', 'FormatString': '0'}, {'Name': 'month', 'Type': 'Text'}, {'Name': 'month_yy_no', 'Type': 'Text', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 3}, {'Name': 'week_no', 'Type': 'Double'}, {'Name': 'week_yy_no', 'Type': 'Text', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 4}, {'Name': 'day_of_week', 'Type': 'Text'}, {'Name': 'month_start', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'month_end', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'quarter_start', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'quarter_end', 'Type': 'DateTime', 'FormatString': 'D'}]}, {'Name': 'cost', 'Columns': [{'Name': 'resId', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'date', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'nok', 'Type': 'Double'}, {'Name': 'raw_usd', 'Type': 'Double'}, {'Name': 'category', 'Type': 'Text'}, {'Name': 'sub_category', 'Type': 'Text'}, {'Name': 'name', 'Type': 'Text'}, {'Name': 'customer_id', 'Type': 'Text'}, {'Name': 'kubeit', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'usd', 'Type': 'Double'}, {'Name': 'customer_name', 'Type': 'Text'}]}, {'Name': 'customers', 'Columns': [{'Name': 'customer_id', 'Type': 'Text'}, {'Name': 'customer_name', 'Type': 'Text'}, {'Name': 'source', 'Type': 'Integer', 'FormatString': '0'}]}, {'Name': 'details', 'Columns': [{'Name': 'resource_id', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'detail', 'Type': 'Text'}, {'Name': 'value', 'Type': 'Text'}, {'Name': 'startDate', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'is_current', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'rn', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'endDate', 'Type': 'DateTime', 'FormatString': 'D'}]}, {'Name': 'regions', 'Columns': [{'Name': 'continent', 'Type': 'Text'}, {'Name': 'location', 'Type': 'Text'}, {'Name': 'geographyId', 'Type': 'Text'}, {'Name': 'latitude', 'Type': 'Text'}, {'Name': 'longitude', 'Type': 'Text'}, {'Name': 'typeId', 'Type': 'Text'}, {'Name': 'isOpen', 'Type': 'Text'}, {'Name': 'hasGroundStation', 'Type': 'Text'}, {'Name': 'yearOpen', 'Type': 'Text'}, {'Name': 'dataResidency', 'Type': 'Text'}, {'Name': 'availableTo', 'Type': 'Text'}, {'Name': 'announcementLink', 'Type': 'Text'}, {'Name': 'productsByRegionLink', 'Type': 'Text'}, {'Name': 'productsByRegionLinkNonRegional', 'Type': 'Text'}, {'Name': 'availabilityZonesId', 'Type': 'Text'}, {'Name': 'id', 'Type': 'Text'}, {'Name': 'displayName', 'Type': 'Text'}]}, {'Name': 'resources', 'Columns': [{'Name': 'resource_id', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'subscription_id', 'Type': 'Text'}, {'Name': 'subscription_name', 'Type': 'Text'}, {'Name': 'location', 'Type': 'Text'}, {'Name': 'resource_group', 'Type': 'Text'}, {'Name': 'type', 'Type': 'Text'}, {'Name': 'name', 'Type': 'Text'}, {'Name': 'customer_id', 'Type': 'Text'}, {'Name': 'current_state', 'Type': 'Text'}, {'Name': 'last_updated_time', 'Type': 'DateTime', 'FormatString': 'G'}, {'Name': 'customer_name', 'Type': 'Text'}]}, {'Name': 'subscriptions', 'Columns': [{'Name': 'subscription_id', 'Type': 'Text'}, {'Name': 'subscription_name', 'Type': 'Text'}, {'Name': 'management_group', 'Type': 'Text'}, {'Name': 'management_group_name', 'Type': 'Text'}]}, {'Name': 'tags', 'Columns': [{'Name': 'resource_id', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'product_centre', 'Type': 'Text'}, {'Name': 'solution_name', 'Type': 'Text'}, {'Name': 'environment', 'Type': 'Text'}, {'Name': 'project_number', 'Type': 'Text'}, {'Name': 'project_task', 'Type': 'Text'}, {'Name': 'owner', 'Type': 'Text'}, {'Name': 'verit-owneremail', 'Type': 'Text'}]}], 'ActiveRelationships': [{'PK': "'subscriptions'[subscription_id]", 'FK': "'resources'[subscription_id]", 'UnidirectionalFilter': "'subscriptions' filters 'resources'"}, {'PK': "'tags'[resource_id]", 'FK': "'resources'[resource_id]", 'BidirectionalFilter': "'tags' and 'resources' filter each other"}, {'PK': "'regions'[id]", 'FK': "'resources'[location]", 'UnidirectionalFilter': "'regions' filters 'resources'"}, {'PK': "'resources'[resource_id]", 'FK': "'tags'[resource_id]", 'BidirectionalFilter': "'resources' and 'tags' filter each other"}, {'PK': "'resources'[resource_id]", 'FK': "'cost'[resId]", 'UnidirectionalFilter': "'resources' filters 'cost'"}, {'PK': "'calendar'[date]", 'FK': "'cost'[date]", 'UnidirectionalFilter': "'calendar' filters 'cost'"}, {'PK': "'resources'[resource_id]", 'FK': "'details'[resource_id]", 'UnidirectionalFilter': "'resources' filters 'details'"}]}})]}
[updates] {'model': {'messages': [AIMessage(content='The requested semantic model data could not be retrieved at this time. Let me know if I should try again or assist you in any other way.', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 1279, 'total_tokens': 1310, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1152}}, 'model_provider': 'openai', 'model_name': 'gpt-4o-2024-11-20', 'system_fingerprint': 'fp_af7f7349a4', 'id': 'chatcmpl-DBfrP087vNAoeE0Qcd5yeu7WPl3fp', 'finish_reason': 'stop', 'logprobs': None}, id='lc_run--019c800d-6d1e-7660-9bd6-457b69195fed-0', tool_calls=[], invalid_tool_calls=[], usage_metadata={'input_tokens': 1279, 'output_tokens': 31, 'total_tokens': 1310, 'input_token_details': {'audio': 0, 'cache_read': 1152}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}}
[values] {'messages': [HumanMessage(content='\n    Inspect this Power BI semantic model using MCP tools.\n\n    Workspace ID: 816f9fea-3392-4ca9-8b02-4343d9e463b9\n    Dataset ID: bf47a12c-18e3-49b3-ad4d-8f90f282928c\n\n    Return:\n    - List of all tables in the above dataset\n    ', additional_kwargs={}, response_metadata={}, id='f5b18ac7-1252-4cad-8ecf-efdd01ccdb4c'), AIMessage(content='', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 41, 'prompt_tokens': 1229, 'total_tokens': 1270, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1152}}, 'model_provider': 'openai', 'model_name': 'gpt-4o-2024-11-20', 'system_fingerprint': 'fp_af7f7349a4', 'id': 'chatcmpl-DBfrIa7lSfNwEqm7y2z86Q8IcCpQn', 'finish_reason': 'tool_calls', 'logprobs': None}, id='lc_run--019c800d-5647-7471-a5c9-cdde68094d98-0', tool_calls=[{'name': 'GetSemanticModelSchema', 'args': {'artifactId': 'bf47a12c-18e3-49b3-ad4d-8f90f282928c'}, 'id': 'call_44iYkUSfMjzmgLfm2jfgCbT1', 'type': 'tool_call'}], invalid_tool_calls=[], usage_metadata={'input_tokens': 1229, 'output_tokens': 41, 'total_tokens': 1270, 'input_token_details': {'audio': 0, 'cache_read': 1152}, 'output_token_details': {'audio': 0, 'reasoning': 0}}), ToolMessage(content=[], name='GetSemanticModelSchema', id='baf3773a-9dd2-4fbf-af99-8c16082b875a', tool_call_id='call_44iYkUSfMjzmgLfm2jfgCbT1', artifact={'structured_content': {'Tables': [{'Name': 'calendar', 'Columns': [{'Name': 'date', 'Type': 'DateTime', 'FormatString': 'D', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 5}, {'Name': 'year', 'Type': 'Text', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 1}, {'Name': 'quarter_no', 'Type': 'Text', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 2}, {'Name': 'quarter_yy_no', 'Type': 'Text'}, {'Name': 'month_no', 'Type': 'Double', 'FormatString': '0'}, {'Name': 'month', 'Type': 'Text'}, {'Name': 'month_yy_no', 'Type': 'Text', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 3}, {'Name': 'week_no', 'Type': 'Double'}, {'Name': 'week_yy_no', 'Type': 'Text', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 4}, {'Name': 'day_of_week', 'Type': 'Text'}, {'Name': 'month_start', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'month_end', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'quarter_start', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'quarter_end', 'Type': 'DateTime', 'FormatString': 'D'}]}, {'Name': 'cost', 'Columns': [{'Name': 'resId', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'date', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'nok', 'Type': 'Double'}, {'Name': 'raw_usd', 'Type': 'Double'}, {'Name': 'category', 'Type': 'Text'}, {'Name': 'sub_category', 'Type': 'Text'}, {'Name': 'name', 'Type': 'Text'}, {'Name': 'customer_id', 'Type': 'Text'}, {'Name': 'kubeit', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'usd', 'Type': 'Double'}, {'Name': 'customer_name', 'Type': 'Text'}]}, {'Name': 'customers', 'Columns': [{'Name': 'customer_id', 'Type': 'Text'}, {'Name': 'customer_name', 'Type': 'Text'}, {'Name': 'source', 'Type': 'Integer', 'FormatString': '0'}]}, {'Name': 'details', 'Columns': [{'Name': 'resource_id', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'detail', 'Type': 'Text'}, {'Name': 'value', 'Type': 'Text'}, {'Name': 'startDate', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'is_current', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'rn', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'endDate', 'Type': 'DateTime', 'FormatString': 'D'}]}, {'Name': 'regions', 'Columns': [{'Name': 'continent', 'Type': 'Text'}, {'Name': 'location', 'Type': 'Text'}, {'Name': 'geographyId', 'Type': 'Text'}, {'Name': 'latitude', 'Type': 'Text'}, {'Name': 'longitude', 'Type': 'Text'}, {'Name': 'typeId', 'Type': 'Text'}, {'Name': 'isOpen', 'Type': 'Text'}, {'Name': 'hasGroundStation', 'Type': 'Text'}, {'Name': 'yearOpen', 'Type': 'Text'}, {'Name': 'dataResidency', 'Type': 'Text'}, {'Name': 'availableTo', 'Type': 'Text'}, {'Name': 'announcementLink', 'Type': 'Text'}, {'Name': 'productsByRegionLink', 'Type': 'Text'}, {'Name': 'productsByRegionLinkNonRegional', 'Type': 'Text'}, {'Name': 'availabilityZonesId', 'Type': 'Text'}, {'Name': 'id', 'Type': 'Text'}, {'Name': 'displayName', 'Type': 'Text'}]}, {'Name': 'resources', 'Columns': [{'Name': 'resource_id', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'subscription_id', 'Type': 'Text'}, {'Name': 'subscription_name', 'Type': 'Text'}, {'Name': 'location', 'Type': 'Text'}, {'Name': 'resource_group', 'Type': 'Text'}, {'Name': 'type', 'Type': 'Text'}, {'Name': 'name', 'Type': 'Text'}, {'Name': 'customer_id', 'Type': 'Text'}, {'Name': 'current_state', 'Type': 'Text'}, {'Name': 'last_updated_time', 'Type': 'DateTime', 'FormatString': 'G'}, {'Name': 'customer_name', 'Type': 'Text'}]}, {'Name': 'subscriptions', 'Columns': [{'Name': 'subscription_id', 'Type': 'Text'}, {'Name': 'subscription_name', 'Type': 'Text'}, {'Name': 'management_group', 'Type': 'Text'}, {'Name': 'management_group_name', 'Type': 'Text'}]}, {'Name': 'tags', 'Columns': [{'Name': 'resource_id', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'product_centre', 'Type': 'Text'}, {'Name': 'solution_name', 'Type': 'Text'}, {'Name': 'environment', 'Type': 'Text'}, {'Name': 'project_number', 'Type': 'Text'}, {'Name': 'project_task', 'Type': 'Text'}, {'Name': 'owner', 'Type': 'Text'}, {'Name': 'verit-owneremail', 'Type': 'Text'}]}], 'ActiveRelationships': [{'PK': "'subscriptions'[subscription_id]", 'FK': "'resources'[subscription_id]", 'UnidirectionalFilter': "'subscriptions' filters 'resources'"}, {'PK': "'tags'[resource_id]", 'FK': "'resources'[resource_id]", 'BidirectionalFilter': "'tags' and 'resources' filter each other"}, {'PK': "'regions'[id]", 'FK': "'resources'[location]", 'UnidirectionalFilter': "'regions' filters 'resources'"}, {'PK': "'resources'[resource_id]", 'FK': "'tags'[resource_id]", 'BidirectionalFilter': "'resources' and 'tags' filter each other"}, {'PK': "'resources'[resource_id]", 'FK': "'cost'[resId]", 'UnidirectionalFilter': "'resources' filters 'cost'"}, {'PK': "'calendar'[date]", 'FK': "'cost'[date]", 'UnidirectionalFilter': "'calendar' filters 'cost'"}, {'PK': "'resources'[resource_id]", 'FK': "'details'[resource_id]", 'UnidirectionalFilter': "'resources' filters 'details'"}]}}), AIMessage(content='The requested semantic model data could not be retrieved at this time. Let me know if I should try again or assist you in any other way.', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 1279, 'total_tokens': 1310, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1152}}, 'model_provider': 'openai', 'model_name': 'gpt-4o-2024-11-20', 'system_fingerprint': 'fp_af7f7349a4', 'id': 'chatcmpl-DBfrP087vNAoeE0Qcd5yeu7WPl3fp', 'finish_reason': 'stop', 'logprobs': None}, id='lc_run--019c800d-6d1e-7660-9bd6-457b69195fed-0', tool_calls=[], invalid_tool_calls=[], usage_metadata={'input_tokens': 1279, 'output_tokens': 31, 'total_tokens': 1310, 'input_token_details': {'audio': 0, 'cache_read': 1152}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}

================ RESULT ================

{'messages': [HumanMessage(content='\n    Inspect this Power BI semantic model using MCP tools.\n\n    Workspace ID: 816f9fea-3392-4ca9-8b02-4343d9e463b9\n    Dataset ID: bf47a12c-18e3-49b3-ad4d-8f90f282928c\n\n    Return:\n    - List of all tables in the above dataset\n    ', additional_kwargs={}, response_metadata={}, id='f5b18ac7-1252-4cad-8ecf-efdd01ccdb4c'), AIMessage(content='', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 41, 'prompt_tokens': 1229, 'total_tokens': 1270, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1152}}, 'model_provider': 'openai', 'model_name': 'gpt-4o-2024-11-20', 'system_fingerprint': 'fp_af7f7349a4', 'id': 'chatcmpl-DBfrIa7lSfNwEqm7y2z86Q8IcCpQn', 'finish_reason': 'tool_calls', 'logprobs': None}, id='lc_run--019c800d-5647-7471-a5c9-cdde68094d98-0', tool_calls=[{'name': 'GetSemanticModelSchema', 'args': {'artifactId': 'bf47a12c-18e3-49b3-ad4d-8f90f282928c'}, 'id': 'call_44iYkUSfMjzmgLfm2jfgCbT1', 'type': 'tool_call'}], invalid_tool_calls=[], usage_metadata={'input_tokens': 1229, 'output_tokens': 41, 'total_tokens': 1270, 'input_token_details': {'audio': 0, 'cache_read': 1152}, 'output_token_details': {'audio': 0, 'reasoning': 0}}), ToolMessage(content=[], name='GetSemanticModelSchema', id='baf3773a-9dd2-4fbf-af99-8c16082b875a', tool_call_id='call_44iYkUSfMjzmgLfm2jfgCbT1', artifact={'structured_content': {'Tables': [{'Name': 'calendar', 'Columns': [{'Name': 'date', 'Type': 'DateTime', 'FormatString': 'D', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 5}, {'Name': 'year', 'Type': 'Text', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 1}, {'Name': 'quarter_no', 'Type': 'Text', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 2}, {'Name': 'quarter_yy_no', 'Type': 'Text'}, {'Name': 'month_no', 'Type': 'Double', 'FormatString': '0'}, {'Name': 'month', 'Type': 'Text'}, {'Name': 'month_yy_no', 'Type': 'Text', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 3}, {'Name': 'week_no', 'Type': 'Double'}, {'Name': 'week_yy_no', 'Type': 'Text', 'HierarchyName': 'date hierarchy', 'HierarchyLevel': 4}, {'Name': 'day_of_week', 'Type': 'Text'}, {'Name': 'month_start', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'month_end', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'quarter_start', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'quarter_end', 'Type': 'DateTime', 'FormatString': 'D'}]}, {'Name': 'cost', 'Columns': [{'Name': 'resId', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'date', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'nok', 'Type': 'Double'}, {'Name': 'raw_usd', 'Type': 'Double'}, {'Name': 'category', 'Type': 'Text'}, {'Name': 'sub_category', 'Type': 'Text'}, {'Name': 'name', 'Type': 'Text'}, {'Name': 'customer_id', 'Type': 'Text'}, {'Name': 'kubeit', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'usd', 'Type': 'Double'}, {'Name': 'customer_name', 'Type': 'Text'}]}, {'Name': 'customers', 'Columns': [{'Name': 'customer_id', 'Type': 'Text'}, {'Name': 'customer_name', 'Type': 'Text'}, {'Name': 'source', 'Type': 'Integer', 'FormatString': '0'}]}, {'Name': 'details', 'Columns': [{'Name': 'resource_id', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'detail', 'Type': 'Text'}, {'Name': 'value', 'Type': 'Text'}, {'Name': 'startDate', 'Type': 'DateTime', 'FormatString': 'D'}, {'Name': 'is_current', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'rn', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'endDate', 'Type': 'DateTime', 'FormatString': 'D'}]}, {'Name': 'regions', 'Columns': [{'Name': 'continent', 'Type': 'Text'}, {'Name': 'location', 'Type': 'Text'}, {'Name': 'geographyId', 'Type': 'Text'}, {'Name': 'latitude', 'Type': 'Text'}, {'Name': 'longitude', 'Type': 'Text'}, {'Name': 'typeId', 'Type': 'Text'}, {'Name': 'isOpen', 'Type': 'Text'}, {'Name': 'hasGroundStation', 'Type': 'Text'}, {'Name': 'yearOpen', 'Type': 'Text'}, {'Name': 'dataResidency', 'Type': 'Text'}, {'Name': 'availableTo', 'Type': 'Text'}, {'Name': 'announcementLink', 'Type': 'Text'}, {'Name': 'productsByRegionLink', 'Type': 'Text'}, {'Name': 'productsByRegionLinkNonRegional', 'Type': 'Text'}, {'Name': 'availabilityZonesId', 'Type': 'Text'}, {'Name': 'id', 'Type': 'Text'}, {'Name': 'displayName', 'Type': 'Text'}]}, {'Name': 'resources', 'Columns': [{'Name': 'resource_id', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'subscription_id', 'Type': 'Text'}, {'Name': 'subscription_name', 'Type': 'Text'}, {'Name': 'location', 'Type': 'Text'}, {'Name': 'resource_group', 'Type': 'Text'}, {'Name': 'type', 'Type': 'Text'}, {'Name': 'name', 'Type': 'Text'}, {'Name': 'customer_id', 'Type': 'Text'}, {'Name': 'current_state', 'Type': 'Text'}, {'Name': 'last_updated_time', 'Type': 'DateTime', 'FormatString': 'G'}, {'Name': 'customer_name', 'Type': 'Text'}]}, {'Name': 'subscriptions', 'Columns': [{'Name': 'subscription_id', 'Type': 'Text'}, {'Name': 'subscription_name', 'Type': 'Text'}, {'Name': 'management_group', 'Type': 'Text'}, {'Name': 'management_group_name', 'Type': 'Text'}]}, {'Name': 'tags', 'Columns': [{'Name': 'resource_id', 'Type': 'Integer', 'FormatString': '0'}, {'Name': 'product_centre', 'Type': 'Text'}, {'Name': 'solution_name', 'Type': 'Text'}, {'Name': 'environment', 'Type': 'Text'}, {'Name': 'project_number', 'Type': 'Text'}, {'Name': 'project_task', 'Type': 'Text'}, {'Name': 'owner', 'Type': 'Text'}, {'Name': 'verit-owneremail', 'Type': 'Text'}]}], 'ActiveRelationships': [{'PK': "'subscriptions'[subscription_id]", 'FK': "'resources'[subscription_id]", 'UnidirectionalFilter': "'subscriptions' filters 'resources'"}, {'PK': "'tags'[resource_id]", 'FK': "'resources'[resource_id]", 'BidirectionalFilter': "'tags' and 'resources' filter each other"}, {'PK': "'regions'[id]", 'FK': "'resources'[location]", 'UnidirectionalFilter': "'regions' filters 'resources'"}, {'PK': "'resources'[resource_id]", 'FK': "'tags'[resource_id]", 'BidirectionalFilter': "'resources' and 'tags' filter each other"}, {'PK': "'resources'[resource_id]", 'FK': "'cost'[resId]", 'UnidirectionalFilter': "'resources' filters 'cost'"}, {'PK': "'calendar'[date]", 'FK': "'cost'[date]", 'UnidirectionalFilter': "'calendar' filters 'cost'"}, {'PK': "'resources'[resource_id]", 'FK': "'details'[resource_id]", 'UnidirectionalFilter': "'resources' filters 'details'"}]}}), AIMessage(content='The requested semantic model data could not be retrieved at this time. Let me know if I should try again or assist you in any other way.', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 1279, 'total_tokens': 1310, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1152}}, 'model_provider': 'openai', 'model_name': 'gpt-4o-2024-11-20', 'system_fingerprint': 'fp_af7f7349a4', 'id': 'chatcmpl-DBfrP087vNAoeE0Qcd5yeu7WPl3fp', 'finish_reason': 'stop', 'logprobs': None}, id='lc_run--019c800d-6d1e-7660-9bd6-457b69195fed-0', tool_calls=[], invalid_tool_calls=[], usage_metadata={'input_tokens': 1279, 'output_tokens': 31, 'total_tokens': 1310, 'input_token_details': {'audio': 0, 'cache_read': 1152}, 'output_token_details': {'audio': 0, 'reasoning': 0}}

how can i see the exact content of the output ignoring the metadata
